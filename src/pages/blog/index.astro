---
import Layout from '../../layouts/Layout.astro';
import LanguageSwitcher from '../../components/LanguageSwitcher.astro';
import { getAllPosts } from '../../data/posts';
import { useTranslations, formatDate } from '../../i18n/utils';
import type { Locale } from '../../i18n/utils';

const lang: Locale = 'en';
const t = useTranslations(lang);
const allPosts = getAllPosts(lang);
---

<Layout title={t('blogTitle')} description={t('blogDescription')} lang={lang}>
  <!-- Header -->
  <header class="flex items-center justify-between w-full">
    <a href="/" class="text-muted-foreground hover:text-foreground transition-colors text-sm">
      {t('backToHome')}
    </a>
    <LanguageSwitcher lang={lang} />
  </header>

  <!-- Title -->
  <h1 class="font-cormorant text-4xl font-semibold text-foreground">{t('blog')}</h1>

  <!-- Posts List -->
  <section class="flex flex-col gap-y-6">
    {allPosts.map((post) => (
      <article class="flex flex-col gap-y-1" data-post-type={post.type || 'professional'}>
        <div class="flex items-baseline justify-between gap-4">
          <div class="flex items-center gap-2">
            {post.pinned && (
              <span class="text-gold text-sm" title="Featured">âœ¦</span>
            )}
            <a
              href={`/blog/${post.slug}/`}
              class="font-cormorant text-xl font-semibold text-foreground hover:text-gold transition-colors"
            >
              {post.title}
            </a>
          </div>
          <time
            datetime={post.date.toISOString()}
            class="shrink-0 text-sm text-muted-foreground hidden sm:block"
          >
            {formatDate(post.date, lang)}
          </time>
        </div>
        <div class="flex items-center gap-2 text-sm text-muted-foreground">
          <span>{post.readTime} {t('minRead')}</span>
        </div>
        {post.description && (
          <p class="text-muted-foreground text-sm mt-1">
            {post.description}
          </p>
        )}
      </article>
    ))}
  </section>

  <script>
    function filterPostsByMode() {
      const mode = new URLSearchParams(window.location.search).get('mode');
      document.querySelectorAll<HTMLElement>('[data-post-type]').forEach(el => {
        const postType = el.getAttribute('data-post-type');
        if (mode && postType !== mode) {
          el.style.display = 'none';
        } else {
          el.style.display = '';
        }
      });
    }
    document.addEventListener('astro:page-load', filterPostsByMode);
  </script>
</Layout>

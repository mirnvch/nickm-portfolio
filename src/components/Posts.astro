---
interface Post {
  title: string;
  slug: string;
  date: Date;
  readTime: number;
  pinned?: boolean;
}

interface Props {
  posts: Post[];
  mode: 'professional' | 'personal';
}

const { posts, mode } = Astro.props;

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-GB', {
    day: 'numeric',
    month: 'short',
    year: 'numeric'
  }).format(date);
}
---

<section
  class="flex flex-col gap-y-4"
  data-mode={mode}
  style="display: none;"
>
  <ul class="posts-list flex flex-col gap-y-3">
    {posts.map((post, index) => (
      <li class="flex items-baseline justify-between gap-4">
        <div class="flex items-center gap-2 min-w-0">
          <a
            href={`/blog/${post.slug}/`}
            class:list={["post-link font-cormorant text-lg font-medium text-foreground", index === 0 && "active"]}
          >
            <span class="post-star">✦</span>
            <span class="post-title">{post.title}</span>
          </a>
          <span class="text-xs text-muted-foreground shrink-0">· {post.readTime} min read</span>
        </div>
        <time
          datetime={post.date.toISOString()}
          class="shrink-0 text-sm text-muted-foreground hidden sm:block"
        >
          {formatDate(post.date)}
        </time>
      </li>
    ))}
  </ul>

  <a
    href="/blog"
    class="text-sm text-muted-foreground hover:text-foreground transition-colors self-start"
  >
    View all posts →
  </a>
</section>

<script>
  function initPostsHover() {
    document.querySelectorAll('.posts-list').forEach(list => {
      const links = list.querySelectorAll('.post-link');

      list.addEventListener('mouseenter', () => {
        // Remove active from first when hovering the list
      });

      links.forEach(link => {
        link.addEventListener('mouseenter', () => {
          // Remove active from all links in this list
          links.forEach(l => l.classList.remove('active'));
          // Add active to hovered link
          link.classList.add('active');
        });
      });

      list.addEventListener('mouseleave', () => {
        // Reset: remove active from all, add to first
        links.forEach(l => l.classList.remove('active'));
        links[0]?.classList.add('active');
      });
    });
  }

  document.addEventListener('DOMContentLoaded', initPostsHover);
  document.addEventListener('astro:after-swap', initPostsHover);
</script>

<style>
  .posts-list {
    overflow: visible;
  }

  .posts-list li {
    overflow: visible;
  }

  .post-link {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    overflow: visible;
  }

  .post-star {
    opacity: 0;
    transform: scale(0.5);
    transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    color: var(--color-gold);
    flex-shrink: 0;
  }

  .post-title {
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), text-shadow 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: left center;
  }

  /* Active state */
  .post-link.active .post-star {
    opacity: 1;
    transform: scale(1);
  }

  .post-link.active .post-title {
    transform: scale(1.02);
    text-shadow: 0 1px 2px rgba(212, 175, 55, 0.6), 0 0 8px rgba(212, 175, 55, 0.3);
  }
</style>

---
import Layout from '../layouts/Layout.astro';
import LanguageSwitcher from './LanguageSwitcher.astro';
import { getPostsByType } from '../data/posts';
import { useTranslations, formatDate, getLocalePath } from '../i18n/utils';
import type { Locale } from '../i18n/utils';

interface Props {
  lang: Locale;
  type: 'professional' | 'personal';
}

const { lang, type } = Astro.props;
const t = useTranslations(lang);
const posts = getPostsByType(lang, type);
const homePath = getLocalePath(lang, '/');
const basePath = getLocalePath(lang, type === 'professional' ? '/blog' : '/notes');
const pageTitle = type === 'professional' ? t('blogTitle') : t('notesTitle');
const pageDescription = type === 'professional' ? t('blogDescription') : t('notesDescription');
const heading = type === 'professional' ? t('blog') : t('notes');
const siteUrl = 'https://nickm.dev';
const pageUrl = `${siteUrl}${basePath}/`;

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": pageTitle,
  "description": pageDescription,
  "url": pageUrl,
  "mainEntity": {
    "@type": "ItemList",
    "itemListElement": posts.map((post, index) => ({
      "@type": "ListItem",
      "position": index + 1,
      "url": `${siteUrl}${basePath}/${post.slug}/`,
      "name": post.title,
    })),
  },
};
---

<Layout title={pageTitle} description={pageDescription} lang={lang} jsonLd={jsonLd}>
  <!-- Header -->
  <header class="flex items-center justify-between w-full">
    <a href={homePath} class="text-muted-foreground hover:text-foreground transition-colors text-sm">
      {t('backToHome')}
    </a>
    <LanguageSwitcher lang={lang} />
  </header>

  <!-- Title -->
  <h1 class="font-cormorant text-4xl font-semibold text-foreground">{heading}</h1>

  <!-- Posts List -->
  <section class="flex flex-col gap-y-6">
    {posts.map((post) => (
      <article class="flex flex-col gap-y-1">
        <div class="flex items-baseline justify-between gap-4">
          <div class="flex items-center gap-2">
            {post.pinned && (
              <span class="text-gold text-sm" title="Featured">âœ¦</span>
            )}
            <a
              href={`${basePath}/${post.slug}/`}
              class="font-cormorant text-xl font-semibold text-foreground hover:text-gold transition-colors"
            >
              {post.title}
            </a>
          </div>
          <time
            datetime={post.date.toISOString()}
            class="shrink-0 text-sm text-muted-foreground hidden sm:block"
          >
            {formatDate(post.date, lang)}
          </time>
        </div>
        <div class="flex items-center gap-2 text-sm text-muted-foreground">
          <span>{post.readTime} {t('minRead')}</span>
        </div>
        {post.description && (
          <p class="text-muted-foreground text-sm mt-1">
            {post.description}
          </p>
        )}
      </article>
    ))}
  </section>
</Layout>
